<html>
	<head>
		<link href="/resource/style.css" rel="stylesheet" type="text/css">
		<script type="text/javascript" src="/resource/info.js"></script>
		<script type="text/javascript" src="/resource/runtime.js"></script>
		<script type="text/javascript" src="/resource/api.js"></script>
		<script type="text/javascript" src="/resource/game.js"></script>
		<script type="text/javascript" src="/resource/events.js"></script>
		<title></title>
	</head>
	<body>
		<img onclick="on_click();" onkeydown="on_keydown();" id="background" height="100%" width="100%">
		<div onclick="on_click();" onkeydown="on_keydown();" id="figures"></div>
		<div class="dialog">
			<p id="character"></p>
			<a class="dialog-text" id="dialog-text"></a>
			<button style="position: absolute;
				right: 15%;
				bottom: 2%;" onclick="location.assign('/');">Home</button>
			<button style="position: absolute;
				right: 10%;
				bottom: 2%;" onclick="to_save_page();">Save</button>
			<button style="position: absolute;
				right: 5%;
				bottom: 2%;" onclick="to_load_page();">Load</button>
		</div>
		<script>
			var game_data = {game_data};
			/* 恢复状态 */
			if(get_url_arg("step") != undefined) {
				step = Number.parseInt(get_url_arg("step"));
			}
			if(get_url_arg("background") != undefined) {
				set_background(get_url_arg("background"));
			}
			if(get_url_arg("music") != undefined) {
				play_sound(get_url_arg("music"));
			}
			function to_save_page() {
				location.assign("/save?" + encode_url_arg({"step": (step - 1).toString(),
					"scene": get_url_arg("scene"),
					"background": current_background}));
			}
			function to_load_page() {
				location.assign("/load?" + encode_url_arg({"step": (step - 1).toString(),
					"scene": get_url_arg("scene"),
					"background": current_background,
					"origin": location.pathname}));
			}
			on_click();
			set_title(get_config("title"));
		</script>
	</body>
</html>